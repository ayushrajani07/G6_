[pytest]
markers =
    optional: Optional developer / exploratory tests (disabled unless G6_ENABLE_OPTIONAL_TESTS=1)
    slow: Slow tests (enable with G6_ENABLE_SLOW_TESTS=1 or run -m slow explicitly)
    integration: Higher-level integration tests (may spin threads / external deps)
    perf: Performance smoke tests (timing thresholds / basic perf assertions)
    asyncio: Mark an async test function (managed by custom event_loop fixture)
    metrics_no_reset: Opt-out of the autouse metrics registry reset fixture (test depends on persistence or handles its own isolation)
    broker: Tests that require broker provider initialization / credentials (enable with G6_ENABLE_BROKER_TESTS=1)
    serial: Tests that must not run under parallel/xdist due to global mutable state
addopts = -q -r fE -n auto -m "not serial" --durations=10
; Restrict discovery to the dedicated tests directory to avoid scanning large data/runtime trees
testpaths = tests
; Prevent recursion into directories with transient generated files or non-test assets
norecursedirs = 
    .git 
    __pycache__ 
    build 
    dist 
    data 
    logs 
    archive 
    grafana 
    prometheus 
    docs 
    scripts 
    config
filterwarnings =
    ignore:datetime\.datetime\.utcfromtimestamp\(\) is deprecated:DeprecationWarning:pytz\\.tzinfo
    ignore:datetime\.datetime\.utcfromtimestamp\(\) is deprecated:DeprecationWarning:influxdb_client\\.client\\.write\\.point
    ignore:datetime\.datetime\.utcfromtimestamp\(\) is deprecated:DeprecationWarning:reactivex\\.internal\\.constants
    # Broad fallback suppression for any remaining third-party modules emitting utcfromtimestamp deprecation
    ignore:datetime\.datetime\.utcfromtimestamp\(\) is deprecated:DeprecationWarning:
    # Suppress legacy deep metrics import warnings entirely (facade is the supported path)
    ignore:.*Importing 'src\.metrics\.metrics' directly is deprecated.*:DeprecationWarning:
    # Suppress planned removal notice for legacy registration shim
    ignore:.*metrics\._register legacy shim is deprecated.*:DeprecationWarning:
    # Suppress pipeline collector deprecation notices routed via warnings
    ignore:G6_PIPELINE_COLLECTOR.*deprecated:DeprecationWarning:
    # Suppress implicit env credentials construction deprecation in provider bootstrap
    ignore:Implicit env credential construction via create_provider\('kite', \{\}\) is deprecated:DeprecationWarning: